{"version":3,"sources":["../../src/modules/subscriptionInvoice/index.ts","../../src/shared/shared.actions.ts","../../src/shared/shared.types.ts","../../src/modules/subscriptionInvoice/subscriptionInvoice.action.ts"],"sourcesContent":["import {\n  listAllSubscriptionInvoices,\n  retrieveSubscriptionInvoice,\n} from \"./subscriptionInvoice.action\";\n\nexport { listAllSubscriptionInvoices, retrieveSubscriptionInvoice };\n\nexport type {\n  LemonsqueezySubscriptionInvoice,\n  ListAllSubscriptionInvoicesOptions,\n  ListAllSubscriptionInvoicesResult,\n  RetrieveSubscriptionInvoiceOptions,\n  RetrieveSubscriptionInvoiceResult,\n} from \"./subscriptionInvoice.types\";\n\nexport default {\n  listAllSubscriptionInvoices,\n  retrieveSubscriptionInvoice,\n} as const;\n","import { fetch } from \"undici\";\nimport { join } from \"node:path\";\n\nimport { LemonsqueezyDataType } from \"~/shared\";\n\nimport type {\n  BaseLemonsqueezyResponse,\n  LemonsqueezyOptions,\n  PaginatedBaseLemonsqueezyResponse,\n} from \"~/shared\";\n\nexport async function requestLemonSqueeze<\n  TResponse extends\n    | BaseLemonsqueezyResponse<any>\n    | PaginatedBaseLemonsqueezyResponse<any>,\n  TData extends Record<string, any> = Record<string, any>\n>({\n  apiKey,\n  apiVersion = \"v1\",\n  baseUrl = \"https://api.lemonsqueezy.com\",\n  data,\n  headers,\n  include,\n  method = \"GET\",\n  page,\n  params,\n  path,\n}: LemonsqueezyOptions<TData>): Promise<TResponse> {\n  try {\n    const url = new URL(join(apiVersion, path), baseUrl);\n\n    if (include)\n      url.searchParams.append(\n        \"include\",\n        include.map((i) => LemonsqueezyDataType[i]).join(\",\")\n      );\n\n    if (page) url.searchParams.append(\"page\", page.toString());\n\n    if (params && method === \"GET\")\n      Object.entries(params).forEach(([key, value]) =>\n        url.searchParams.append(key, value)\n      );\n\n    const response = await fetch(url.href, {\n      headers: {\n        Accept: \"application/vnd.api+json\",\n        Authorization: `Bearer ${apiKey}`,\n        \"Content-Type\": \"application/vnd.api+json\",\n        ...headers,\n      },\n      method,\n      ...(data && method !== \"GET\"\n        ? {\n            body: JSON.stringify(data),\n          }\n        : {}),\n    });\n    if (!response.ok) {\n      const errorsJson = (await response.json()) as {\n        errors: Array<{\n          detail: string;\n          status: number;\n          title: string;\n        }>;\n      };\n      throw {\n        status: response.status,\n        message: response.statusText,\n        errors: errorsJson.errors,\n      };\n    }\n\n    const json = (await response.json()) as TResponse;\n    if (json.errors && json.errors.length > 0) throw json;\n\n    return json;\n  } catch (error) {\n    throw error;\n  }\n}\n","import type { RequestInit } from \"undici\";\n\nexport interface SharedModuleOptions {\n  apiKey: string;\n  page?: number;\n  include?: Array<keyof typeof LemonsqueezyDataType>;\n}\n\nexport interface SharedLemonsqueezyOptions {\n  apiVersion?: \"v1\";\n  baseUrl?: string;\n}\n\nexport interface LemonsqueezyOptions<\n  TData extends Record<string, any> = Record<string, any>\n> extends Omit<RequestInit, \"body\">,\n    SharedLemonsqueezyOptions,\n    SharedModuleOptions {\n  data?: TData;\n  params?: Record<string, any>;\n  method?:\n    | \"CONNECT\"\n    | \"DELETE\"\n    | \"GET\"\n    | \"HEAD\"\n    | \"OPTIONS\"\n    | \"PATCH\"\n    | \"POST\"\n    | \"PUT\"\n    | \"TRACE\";\n  path: string;\n}\n\nexport enum LemonsqueezyDataType {\n  checkouts = \"checkouts\",\n  customers = \"customers\",\n  discounts = \"discounts\",\n  files = \"files\",\n  license_key_instances = \"license-key-instances\",\n  license_keys = \"license-keys\",\n  order_items = \"order-items\",\n  orders = \"orders\",\n  products = \"products\",\n  stores = \"stores\",\n  subscriptions = \"subscriptions\",\n  subscription_invoices = \"subscription-invoices\",\n  users = \"users\",\n  variants = \"variants\",\n}\n\nexport interface BaseLemonsqueezyResponse<\n  TData,\n  TLinks = {\n    self: string;\n  }\n> {\n  data: TData;\n  errors?: Array<{\n    detail: string;\n    status: string | number;\n    title: string;\n  }>;\n  jsonapi: {\n    version: string;\n  };\n  links: TLinks;\n}\n\nexport interface PaginatedBaseLemonsqueezyResponse<\n  TData,\n  TLinks = {\n    first: string;\n    last: string;\n  }\n> extends BaseLemonsqueezyResponse<TData, TLinks> {\n  meta: {\n    page: {\n      currentPage: number;\n      from: number;\n      lastPage: number;\n      perPage: number;\n      to: number;\n      total: number;\n    };\n  };\n}\n","import { requestLemonSqueeze } from \"~/shared\";\n\nimport type {\n  ListAllSubscriptionInvoicesOptions,\n  ListAllSubscriptionInvoicesResult,\n  RetrieveSubscriptionInvoiceOptions,\n  RetrieveSubscriptionInvoiceResult,\n} from \"./subscriptionInvoice.types\";\nimport type { SharedModuleOptions } from \"~/shared\";\n\n/**\n * List all subscription invoices\n *\n * @description Returns a paginated list of subscriptions\n *\n * @docs https://docs.lemonsqueezy.com/api/subscription-invoices#list-all-subscription-invoices\n *\n * @param {Object} [options]\n *\n * @returns Returns a paginated list of subscription invoice objects.\n */\nexport async function listAllSubscriptionInvoices(\n  options: ListAllSubscriptionInvoicesOptions & SharedModuleOptions\n): Promise<ListAllSubscriptionInvoicesResult> {\n  const { refunded, status, storeId, ...rest } = options;\n\n  return requestLemonSqueeze<ListAllSubscriptionInvoicesResult>({\n    params: {\n      ...(refunded ? { refunded } : {}),\n      ...(status ? { status } : {}),\n      ...(storeId ? { store_id: storeId } : {}),\n    },\n    path: \"/subscription-invoices\",\n    ...rest,\n  });\n}\n\n/**\n * Retrieve subscription invoice\n *\n * @description Retrieves a subscription invoice with the given ID\n *\n * @docs https://docs.lemonsqueezy.com/api/subscription-invoices#retrieve-a-subscription-invoice\n *\n * @param {String} options.id - The ID of the subscription invoice to retrieve\n *\n * @returns A subscription invoice object\n */\nexport async function retrieveSubscriptionInvoice(\n  options: RetrieveSubscriptionInvoiceOptions & SharedModuleOptions\n): Promise<RetrieveSubscriptionInvoiceResult> {\n  const { id, ...rest } = options;\n\n  return requestLemonSqueeze<RetrieveSubscriptionInvoiceResult>({\n    path: `/subscription-invoices/${id}`,\n    ...rest,\n  });\n}\n"],"mappings":"yaAAA,IAAAA,EAAA,GAAAC,EAAAD,EAAA,aAAAE,EAAA,gCAAAC,EAAA,gCAAAC,IAAA,eAAAC,EAAAL,GCAA,IAAAM,EAAsB,kBACtBC,EAAqB,gBAUrB,eAAsBC,EAKpB,CACA,OAAAC,EACA,WAAAC,EAAa,KACb,QAAAC,EAAU,+BACV,KAAAC,EACA,QAAAC,EACA,QAAAC,EACA,OAAAC,EAAS,MACT,KAAAC,EACA,OAAAC,EACA,KAAAC,CACF,EAAmD,CACjD,GAAI,CACF,IAAMC,EAAM,IAAI,OAAI,QAAKT,EAAYQ,CAAI,EAAGP,CAAO,EAE/CG,GACFK,EAAI,aAAa,OACf,UACAL,EAAQ,IAAKM,GAAMC,EAAqBD,CAAC,CAAC,EAAE,KAAK,GAAG,CACtD,EAEEJ,GAAMG,EAAI,aAAa,OAAO,OAAQH,EAAK,SAAS,CAAC,EAErDC,GAAUF,IAAW,OACvB,OAAO,QAAQE,CAAM,EAAE,QAAQ,CAAC,CAACK,EAAKC,CAAK,IACzCJ,EAAI,aAAa,OAAOG,EAAKC,CAAK,CACpC,EAEF,IAAMC,EAAW,QAAM,SAAML,EAAI,KAAM,CACrC,QAAS,CACP,OAAQ,2BACR,cAAe,UAAUV,CAAM,GAC/B,eAAgB,2BAChB,GAAGI,CACL,EACA,OAAAE,EACA,GAAIH,GAAQG,IAAW,MACnB,CACE,KAAM,KAAK,UAAUH,CAAI,CAC3B,EACA,CAAC,CACP,CAAC,EACD,GAAI,CAACY,EAAS,GAAI,CAChB,IAAMC,EAAc,MAAMD,EAAS,KAAK,EAOxC,KAAM,CACJ,OAAQA,EAAS,OACjB,QAASA,EAAS,WAClB,OAAQC,EAAW,MACrB,CACF,CAEA,IAAMC,EAAQ,MAAMF,EAAS,KAAK,EAClC,GAAIE,EAAK,QAAUA,EAAK,OAAO,OAAS,EAAG,MAAMA,EAEjD,OAAOA,CACT,OAASC,EAAO,CACd,MAAMA,CACR,CACF,CC/CO,IAAKC,OACVA,EAAA,UAAY,YACZA,EAAA,UAAY,YACZA,EAAA,UAAY,YACZA,EAAA,MAAQ,QACRA,EAAA,sBAAwB,wBACxBA,EAAA,aAAe,eACfA,EAAA,YAAc,cACdA,EAAA,OAAS,SACTA,EAAA,SAAW,WACXA,EAAA,OAAS,SACTA,EAAA,cAAgB,gBAChBA,EAAA,sBAAwB,wBACxBA,EAAA,MAAQ,QACRA,EAAA,SAAW,WAdDA,OAAA,ICZZ,eAAsBC,EACpBC,EAC4C,CAC5C,GAAM,CAAE,SAAAC,EAAU,OAAAC,EAAQ,QAAAC,EAAS,GAAGC,CAAK,EAAIJ,EAE/C,OAAOK,EAAuD,CAC5D,OAAQ,CACN,GAAIJ,EAAW,CAAE,SAAAA,CAAS,EAAI,CAAC,EAC/B,GAAIC,EAAS,CAAE,OAAAA,CAAO,EAAI,CAAC,EAC3B,GAAIC,EAAU,CAAE,SAAUA,CAAQ,EAAI,CAAC,CACzC,EACA,KAAM,yBACN,GAAGC,CACL,CAAC,CACH,CAaA,eAAsBE,EACpBN,EAC4C,CAC5C,GAAM,CAAE,GAAAO,EAAI,GAAGH,CAAK,EAAIJ,EAExB,OAAOK,EAAuD,CAC5D,KAAM,0BAA0BE,CAAE,GAClC,GAAGH,CACL,CAAC,CACH,CH1CA,IAAOI,EAAQ,CACb,4BAAAC,EACA,4BAAAC,CACF","names":["subscriptionInvoice_exports","__export","subscriptionInvoice_default","listAllSubscriptionInvoices","retrieveSubscriptionInvoice","__toCommonJS","import_undici","import_node_path","requestLemonSqueeze","apiKey","apiVersion","baseUrl","data","headers","include","method","page","params","path","url","i","LemonsqueezyDataType","key","value","response","errorsJson","json","error","LemonsqueezyDataType","listAllSubscriptionInvoices","options","refunded","status","storeId","rest","requestLemonSqueeze","retrieveSubscriptionInvoice","id","subscriptionInvoice_default","listAllSubscriptionInvoices","retrieveSubscriptionInvoice"]}